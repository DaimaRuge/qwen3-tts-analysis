# æŠ€æœ¯æ¶æ„ä¸æºç ç ”è¯»æŠ¥å‘Š
## Microsoft Agent Framework

---

**é¡¹ç›®åç§°**: Microsoft Agent Framework  
**GitHub åœ°å€**: https://github.com/microsoft/agent-framework  
**åˆ†ææ—¥æœŸ**: 2026å¹´2æœˆ12æ—¥  
**æŠ¥å‘Šç‰ˆæœ¬**: v1.0  

---

## ä¸€ã€é¡¹ç›®æ¦‚è¿°

Microsoft Agent Framework æ˜¯å¾®è½¯æ¨å‡ºçš„ç»¼åˆæ€§å¤šè¯­è¨€ AI Agent å¼€å‘æ¡†æ¶ï¼Œæ”¯æŒ Python å’Œ .NET (C#) åŒæ ˆå®ç°ã€‚è¯¥æ¡†æ¶æ—¨åœ¨ç®€åŒ– AI Agent çš„æ„å»ºã€ç¼–æ’å’Œéƒ¨ç½²æµç¨‹ï¼Œä»ç®€å•çš„èŠå¤© Agent åˆ°å¤æ‚çš„å¤š Agent å·¥ä½œæµï¼Œæä¾›äº†ä¸€æ•´å¥—ä¼ä¸šçº§è§£å†³æ–¹æ¡ˆã€‚

### æ ¸å¿ƒå®šä½
- **åŒæ ˆæ”¯æŒ**: Python + .NET åŸç”Ÿæ”¯æŒ
- **ä¼ä¸šçº§**: å¾®è½¯å®˜æ–¹å‡ºå“ï¼Œæ³¨é‡ç”Ÿäº§ç¯å¢ƒç¨³å®šæ€§
- **ç”Ÿæ€æ•´åˆ**: æ·±åº¦é›†æˆ Azure OpenAIã€Semantic Kernelã€AutoGen ç­‰
- **å¯è§‚æµ‹æ€§**: å†…ç½® OpenTelemetry åˆ†å¸ƒå¼è¿½è¸ª

---

## äºŒã€æ•´ä½“æ¶æ„è®¾è®¡

### 2.1 æ¶æ„åˆ†å±‚

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚                      åº”ç”¨å±‚ (Applications)                    â”‚
â”‚   â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â” â”‚
â”‚   â”‚ Chat Agents â”‚  â”‚ Multi-Agent â”‚  â”‚    Workflow Apps    â”‚ â”‚
â”‚   â”‚   (èŠå¤©ä»£ç†)  â”‚  â”‚  Workflows  â”‚  â”‚     (å·¥ä½œæµåº”ç”¨)     â”‚ â”‚
â”‚   â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜ â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚                    ç¼–æ’å±‚ (Orchestration)                    â”‚
â”‚   â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â” â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â” â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â” â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”‚
â”‚   â”‚Sequentialâ”‚ â”‚Concurrentâ”‚ â”‚ GroupChatâ”‚ â”‚   Handoff    â”‚  â”‚
â”‚   â”‚ (é¡ºåº)    â”‚ â”‚ (å¹¶å‘)    â”‚ â”‚(ç¾¤ç»„èŠå¤©) â”‚ â”‚  (äº¤æ¥)       â”‚  â”‚
â”‚   â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜ â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜ â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜ â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜  â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚                      Agent æ ¸å¿ƒå±‚                            â”‚
â”‚   â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”   â”‚
â”‚   â”‚   Agent Core   â”‚  â”‚   Tools      â”‚  â”‚   Memory     â”‚   â”‚
â”‚   â”‚   (Agent æ ¸å¿ƒ)  â”‚  â”‚  (å·¥å…·ç³»ç»Ÿ)   â”‚  â”‚  (è®°å¿†ç®¡ç†)   â”‚   â”‚
â”‚   â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜   â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚                    å®¢æˆ·ç«¯é€‚é…å±‚ (Clients)                     â”‚
â”‚   â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â” â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â” â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â” â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â” â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â” â”‚
â”‚   â”‚ OpenAI â”‚ â”‚ Azure  â”‚ â”‚Anthropic â”‚ â”‚ Ollama â”‚ â”‚ Bedrockâ”‚ â”‚
â”‚   â””â”€â”€â”€â”€â”€â”€â”€â”€â”˜ â””â”€â”€â”€â”€â”€â”€â”€â”€â”˜ â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜ â””â”€â”€â”€â”€â”€â”€â”€â”€â”˜ â””â”€â”€â”€â”€â”€â”€â”€â”€â”˜ â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚                    åŸºç¡€è®¾æ–½å±‚ (Infrastructure)                â”‚
â”‚   â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â” â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â” â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â” â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”‚
â”‚   â”‚Middlewareâ”‚ â”‚Telemetry â”‚ â”‚   MCP    â”‚ â”‚ Declarative  â”‚  â”‚
â”‚   â”‚(ä¸­é—´ä»¶)   â”‚ â”‚(å¯è§‚æµ‹æ€§) â”‚ â”‚ (åè®®)   â”‚ â”‚   (å£°æ˜å¼)   â”‚  â”‚
â”‚   â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜ â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜ â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜ â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜  â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

### 2.2 æ¨¡å—ä¾èµ–å…³ç³»

```
                    â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
                    â”‚   Application   â”‚
                    â””â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                             â”‚
              â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
              â”‚              â”‚              â”‚
              â–¼              â–¼              â–¼
    â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â” â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â” â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
    â”‚  Orchestrations â”‚ â”‚  Agents  â”‚ â”‚     DevUI       â”‚
    â””â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”˜ â””â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”˜ â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
             â”‚               â”‚
             â””â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”˜
                     â”‚
                     â–¼
           â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
           â”‚  Core Package   â”‚
           â”‚ (Clients/Tools) â”‚
           â””â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                    â”‚
        â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
        â”‚           â”‚           â”‚
        â–¼           â–¼           â–¼
   â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â” â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â” â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
   â”‚ OpenAI â”‚ â”‚  Azure   â”‚ â”‚ Anthropicâ”‚
   â””â”€â”€â”€â”€â”€â”€â”€â”€â”˜ â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜ â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

---

## ä¸‰ã€æ ¸å¿ƒç»„ä»¶æ·±åº¦åˆ†æ

### 3.1 Agent æ ¸å¿ƒæ¶æ„ (`_agents.py`)

#### 3.1.1 ç±»ç»§æ‰¿ä½“ç³»

```python
# åè®®å®šä¹‰
SupportsAgentRun (Protocol)
    â†“
BaseAgent (åŸºç±»)
    â†“
RawAgent (é€šç”¨å®ç°)
    â†“
Agent (å®Œæ•´åŠŸèƒ½)
```

#### 3.1.2 æ ¸å¿ƒç±»è§£æ

**BaseAgent - åŸºç¡€æŠ½è±¡**
```python
class BaseAgent(SerializationMixin):
    """
    æ‰€æœ‰ Agent çš„åŸºç±»ï¼Œæä¾›ï¼š
    - ID/åç§°/æè¿°ç®¡ç†
    - ä¸Šä¸‹æ–‡æä¾›è€… (Context Provider)
    - ä¸­é—´ä»¶æ”¯æŒ
    - çº¿ç¨‹ç®¡ç† (AgentThread)
    """
    def __init__(
        self,
        *,
        id: str | None = None,
        name: str | None = None,
        description: str | None = None,
        context_provider: ContextProvider | None = None,
        middleware: Sequence[MiddlewareTypes] | None = None,
        additional_properties: MutableMapping[str, Any] | None = None,
        **kwargs: Any
    ) -> None
```

**RawAgent - æ ¸å¿ƒå®ç°**
```python
class RawAgent(BaseAgent, Generic[OptionsCoT]):
    """
    æ— ä¸­é—´ä»¶å’Œé¥æµ‹å±‚çš„åŸå§‹ Agent å®ç°
    æ ¸å¿ƒèŒè´£ï¼š
    - ç®¡ç† ChatClient è¿æ¥
    - å¤„ç†å·¥å…·è°ƒç”¨
    - ç®¡ç†å¯¹è¯çº¿ç¨‹
    - æ”¯æŒæµå¼/éæµå¼å“åº”
    """
    
    # å…³é”®è®¾è®¡ï¼šæ³›å‹ç±»å‹å‚æ•° OptionsCoT
    # å…è®¸ IDE è‡ªåŠ¨è¡¥å…¨ provider-specific å‚æ•°
    def __init__(
        self,
        client: SupportsChatGetResponse[OptionsCoT],
        instructions: str | None = None,
        *,
        tools: [...],           # å·¥å…·é…ç½®
        default_options: OptionsCoT | None = None,
        chat_message_store_factory: Callable[[], ChatMessageStoreProtocol] | None = None,
        **kwargs: Any
    ) -> None
```

#### 3.1.3 å…³é”®è®¾è®¡æ¨¡å¼

**1. åè®®ä¼˜å…ˆ (Protocol-First)**
```python
@runtime_checkable
class SupportsAgentRun(Protocol):
    """ä½¿ç”¨ç»“æ„å­ç±»å‹ï¼ˆé¸­å­ç±»å‹ï¼‰
    å…è®¸è‡ªå®šä¹‰ Agent æ— éœ€ç»§æ‰¿æ¡†æ¶ç±»
    """
    id: str
    name: str | None
    description: str | None
    
    def run(self, messages, *, stream=False, thread=None, **kwargs) -> ...
    def get_new_thread(self, **kwargs) -> AgentThread
```

**2. å¼‚æ­¥ä¸Šä¸‹æ–‡ç®¡ç†**
```python
async def __aenter__(self) -> Self:
    """è‡ªåŠ¨ç®¡ç† MCP å·¥å…·å’Œå®¢æˆ·ç«¯çš„ç”Ÿå‘½å‘¨æœŸ"""
    for context_manager in chain([self.client], self.mcp_tools):
        if isinstance(context_manager, AbstractAsyncContextManager):
            await self._async_exit_stack.enter_async_context(context_manager)
    return self

async def __aexit__(self, exc_type, exc_val, exc_tb) -> None:
    await self._async_exit_stack.aclose()
```

**3. æ–¹æ³•é‡è½½æ”¯æŒæµå¼/éæµå¼**
```python
@overload
def run(self, messages, *, stream: Literal[False] = ...) -> Awaitable[AgentResponse]:
    """éæµå¼å“åº”"""

@overload  
def run(self, messages, *, stream: Literal[True]) -> ResponseStream[AgentResponseUpdate, AgentResponse]:
    """æµå¼å“åº” - è¿”å›å¯è¿­ä»£æµ"""
```

### 3.2 å®¢æˆ·ç«¯æŠ½è±¡å±‚ (`_clients.py`)

#### 3.2.1 åè®®è®¾è®¡

```python
@runtime_checkable
class SupportsChatGetResponse(Protocol[OptionsContraT]):
    """
    ChatClient å¿…é¡»å®ç°çš„åè®®
    æ³›å‹å‚æ•° OptionsContraT æ”¯æŒç±»å‹å®‰å…¨çš„é€‰é¡¹ä¼ é€’
    """
    additional_properties: dict[str, Any]
    
    def get_response(
        self,
        messages: str | Message | Sequence[str | Message],
        *,
        stream: bool = False,
        options: OptionsContraT | ChatOptions[Any] | None = None,
        **kwargs: Any
    ) -> Awaitable[ChatResponse[Any]] | ResponseStream[ChatResponseUpdate, ChatResponse[Any]]
```

#### 3.2.2 æŠ½è±¡åŸºç±»è®¾è®¡

```python
class BaseChatClient(SerializationMixin, ABC, Generic[OptionsCoT]):
    """
    å®¢æˆ·ç«¯æŠ½è±¡åŸºç±»ç‰¹ç‚¹ï¼š
    1. æ— ä¸­é—´ä»¶/é¥æµ‹åŒ…è£… - ä¿æŒç®€æ´
    2. æ¶ˆæ¯é¢„å¤„ç†æ ‡å‡†åŒ–
    3. å·¥å…·è§„èŒƒåŒ–
    4. å­ç±»åªéœ€å®ç° _inner_get_response
    """
    
    @abstractmethod
    def _inner_get_response(
        self,
        *,
        messages: Sequence[Message],
        stream: bool,
        options: Mapping[str, Any],
        **kwargs: Any,
    ) -> Awaitable[ChatResponse] | ResponseStream[ChatResponseUpdate, ChatResponse]
```

#### 3.2.3 å·¥å…·æ”¯æŒåè®®

```python
# å¯é€‰èƒ½åŠ›åè®® - å®¢æˆ·ç«¯å¯æŒ‰éœ€å®ç°
@runtime_checkable
class SupportsCodeInterpreterTool(Protocol):
    @staticmethod
    def get_code_interpreter_tool(**kwargs: Any) -> Any

@runtime_checkable
class SupportsWebSearchTool(Protocol):
    @staticmethod
    def get_web_search_tool(**kwargs: Any) -> Any

@runtime_checkable
class SupportsMCPTool(Protocol):
    @staticmethod
    def get_mcp_tool(**kwargs: Any) -> Any
```

### 3.3 å·¥å…·ç³»ç»Ÿ (`_tools.py`)

#### 3.3.1 FunctionTool - æ ¸å¿ƒå·¥å…·ç±»

```python
class FunctionTool(SerializationMixin, Generic[ArgsT, ReturnT]):
    """
    å°† Python å‡½æ•°åŒ…è£…ä¸º AI å¯è°ƒç”¨çš„å·¥å…·
    
    æ ¸å¿ƒèƒ½åŠ›ï¼š
    - è‡ªåŠ¨ Pydantic æ¨¡å‹ç”Ÿæˆï¼ˆä»å‡½æ•°ç­¾åï¼‰
    - JSON Schema ç”Ÿæˆ
    - å‚æ•°éªŒè¯
    - è°ƒç”¨ç»Ÿè®¡/é¥æµ‹
    - å®¡æ‰¹æ¨¡å¼æ”¯æŒ
    """
    
    def __init__(
        self,
        name: str,
        description: str,
        func: Callable[[ArgsT], ReturnT],
        input_model: type[ArgsT],
        *,
        approval_mode: Literal["always_require", "never_require"] = "never_require",
        return_content: bool = True,
        additional_properties: dict[str, Any] | None = None,
    ) -> None
```

#### 3.3.2 å·¥å…·è£…é¥°å™¨

```python
def tool(
    func: Callable[..., Any] | None = None,
    *,
    name: str | None = None,
    description: str | None = None,
    approval_mode: Literal["always_require", "never_require"] = "never_require",
    return_content: bool = True,
) -> Callable[..., FunctionTool[Any, Any]]:
    """
    è£…é¥°å™¨æ¨¡å¼ç®€åŒ–å·¥å…·åˆ›å»º
    
    @tool
    def get_weather(location: str, unit: str = "celsius") -> str:
        return f"Weather in {location}..."
    """
```

#### 3.3.3 å‡½æ•°è°ƒç”¨å±‚

```python
class FunctionInvocationLayer:
    """
    å¤„ç†å·¥å…·è°ƒç”¨å¾ªç¯
    
    æ ¸å¿ƒç®—æ³•ï¼š
    - å·¥å…·è°ƒç”¨è¯†åˆ«ä¸è§£æ
    - å¹¶è¡Œæ‰§è¡Œå¤šä¸ªå·¥å…·è°ƒç”¨
    - ç»“æœåé¦ˆç»™ LLM
    - è¿­ä»£ç›´åˆ°å®Œæˆæˆ–è¾¾åˆ°é™åˆ¶
    """
    DEFAULT_MAX_ITERATIONS: Final[int] = 40
    DEFAULT_MAX_CONSECUTIVE_ERRORS_PER_REQUEST: Final[int] = 3
```

### 3.4 ç¼–æ’ç³»ç»Ÿ (Orchestrations)

#### 3.4.1 ç¼–æ’æ¨¡å¼ä¸€è§ˆ

| æ¨¡å¼ | æ–‡ä»¶ | é€‚ç”¨åœºæ™¯ |
|------|------|----------|
| Sequential | `_sequential.py` | é¡ºåºæ‰§è¡Œå¤šä¸ªæ­¥éª¤ |
| Concurrent | `_concurrent.py` | å¹¶è¡Œæ‰§è¡Œå¤šä¸ª Agent |
| GroupChat | `_group_chat.py` | å¤š Agent è®¨è®ºåä½œ |
| Handoff | `_handoff.py` | Agent é—´ä»»åŠ¡äº¤æ¥ |
| Magentic | `_magentic.py` | ç£å¸å¼ Agent ç¼–æ’ |

#### 3.4.2 çŠ¶æ€ç®¡ç†

```python
class OrchestrationState:
    """
    å·¥ä½œæµçŠ¶æ€ç®¡ç†
    - æ”¯æŒæŒä¹…åŒ–
    - æ£€æŸ¥ç‚¹ (Checkpointing)
    - æ—¶é—´æ—…è¡Œ (Time Travel)
    - äººæœºåä½œ (Human-in-the-loop)
    """
```

---

## å››ã€Package æ¶æ„åˆ†æ

### 4.1 Python Packages ç»“æ„

```
python/packages/
â”œâ”€â”€ core/                    # æ ¸å¿ƒæ¡†æ¶
â”‚   â”œâ”€â”€ _agents.py          # Agent å®ç°
â”‚   â”œâ”€â”€ _clients.py         # å®¢æˆ·ç«¯æŠ½è±¡
â”‚   â”œâ”€â”€ _tools.py           # å·¥å…·ç³»ç»Ÿ
â”‚   â”œâ”€â”€ _threads.py         # çº¿ç¨‹ç®¡ç†
â”‚   â”œâ”€â”€ _memory.py          # è®°å¿†/ä¸Šä¸‹æ–‡
â”‚   â”œâ”€â”€ _middleware.py      # ä¸­é—´ä»¶
â”‚   â”œâ”€â”€ _telemetry.py       # é¥æµ‹
â”‚   â””â”€â”€ _types.py           # ç±»å‹å®šä¹‰
â”‚
â”œâ”€â”€ orchestrations/         # ç¼–æ’ç³»ç»Ÿ
â”‚   â”œâ”€â”€ _sequential.py
â”‚   â”œâ”€â”€ _concurrent.py
â”‚   â”œâ”€â”€ _group_chat.py
â”‚   â””â”€â”€ _handoff.py
â”‚
â”œâ”€â”€ openai/                 # OpenAI é€‚é…
â”œâ”€â”€ azure-ai/              # Azure OpenAI é€‚é…
â”œâ”€â”€ anthropic/             # Claude é€‚é…
â”œâ”€â”€ bedrock/               # AWS Bedrock é€‚é…
â”œâ”€â”€ ollama/                # æœ¬åœ°æ¨¡å‹é€‚é…
â”œâ”€â”€ chatkit/               # å¯¹è¯å·¥å…·åŒ…
â”œâ”€â”€ devui/                 # å¼€å‘è€… UI
â”œâ”€â”€ declarative/           # å£°æ˜å¼å·¥ä½œæµ
â”œâ”€â”€ mem0/                  # è®°å¿†å¢å¼º
â”œâ”€â”€ a2a/                   # Agent-to-Agent åè®®
â””â”€â”€ durabletask/           # æŒä¹…åŒ–ä»»åŠ¡
```

### 4.2 è®¾è®¡åŸåˆ™

**1. æ¨¡å—åŒ–ä¸å¯æ’æ‹”**
```python
# æ¯ä¸ª Provider æ˜¯ç‹¬ç«‹ Package
# æ ¸å¿ƒä»…ä¾èµ–åè®®ï¼Œä¸ä¾èµ–å…·ä½“å®ç°
from agent_framework import SupportsChatGetResponse

class OpenAIChatClient(BaseChatClient):
    # å®ç°åè®®å³å¯é›†æˆ
```

**2. æ¸è¿›å¼å¤æ‚åº¦**
```python
# Level 1: ç®€å• Agent
agent = client.as_agent(name="helper")

# Level 2: å¸¦å·¥å…·
agent = client.as_agent(tools=[get_weather, search])

# Level 3: å·¥ä½œæµ
workflow = Sequential([agent1, agent2, agent3])

# Level 4: å£°æ˜å¼
# workflow.yaml
```

**3. ç±»å‹å®‰å…¨**
```python
# æ³›å‹å‚æ•°ç¡®ä¿ IDE è‡ªåŠ¨è¡¥å…¨
agent: Agent[OpenAIChatOptions] = client.as_agent()
response = await agent.run(
    "Hello",
    options={
        "temperature": 0.7,
        "reasoning_effort": "high",  # IDE è‡ªåŠ¨æç¤º
    }
)
```

---

## äº”ã€å…³é”®æŠ€æœ¯äº®ç‚¹

### 5.1 MCP (Model Context Protocol) é›†æˆ

```python
# æ”¯æŒå°† Agent ä½œä¸º MCP Server
server = agent.as_mcp_server(
    server_name="MyAgent",
    version="1.0"
)

# æ”¯æŒè¿æ¥å¤–éƒ¨ MCP æœåŠ¡å™¨
mcp_tool = client.get_mcp_tool(
    name="filesystem",
    url="http://localhost:3000/sse"
)
```

### 5.2 ä¸­é—´ä»¶ç³»ç»Ÿ

```python
class AgentMiddlewareLayer:
    """
    è¯·æ±‚/å“åº”æ‹¦æˆªå¤„ç†
    - æ—¥å¿—è®°å½•
    - é‡è¯•é€»è¾‘
    - ç¼“å­˜
    - æƒé™æ§åˆ¶
    """
    
async def process_request(self, context: RequestContext) -> RequestContext:
    # å‰ç½®å¤„ç†
    
async def process_response(self, context: ResponseContext) -> ResponseContext:
    # åç½®å¤„ç†
```

### 5.3 å¯è§‚æµ‹æ€§è®¾è®¡

```python
# OpenTelemetry åŸç”Ÿé›†æˆ
from agent_framework.observability import AgentTelemetryLayer

class Agent(RawAgent):
    """
    å®Œæ•´ Agent = RawAgent + Middleware + Telemetry
    """
    def run(self, ...):
        with tracer.start_as_current_span("agent.run"):
            # è‡ªåŠ¨è®°å½•ï¼š
            # - è¾“å…¥/è¾“å‡º token
            # - å»¶è¿Ÿåˆ†å¸ƒ
            # - å·¥å…·è°ƒç”¨æ¬¡æ•°
            # - é”™è¯¯ç‡
```

### 5.4 çº¿ç¨‹ç®¡ç†ç­–ç•¥

```python
class AgentThread:
    """
    å¯¹è¯çŠ¶æ€ç®¡ç†
    
    æ”¯æŒä¸‰ç§æ¨¡å¼ï¼š
    1. æ— çŠ¶æ€ - ä»…å†…å­˜å­˜å‚¨
    2. æœ¬åœ°ç®¡ç† - ChatMessageStore
    3. æœåŠ¡ç®¡ç† - Service Thread ID (å¦‚ OpenAI Threads API)
    """
    service_thread_id: str | None      # æœåŠ¡ç«¯çº¿ç¨‹
    message_store: ChatMessageStoreProtocol | None  # æœ¬åœ°å­˜å‚¨
```

---

## å…­ã€ä¸ç«å“å¯¹æ¯”

| ç‰¹æ€§ | Microsoft Agent Framework | LangChain | AutoGen | CrewAI |
|------|---------------------------|-----------|---------|--------|
| å¤šè¯­è¨€ | Python + .NET | Python | Python | Python |
| å®˜æ–¹èƒŒä¹¦ | å¾®è½¯ | LangChain Inc | å¾®è½¯ | ç‹¬ç«‹ |
| å·¥ä½œæµ | å›¾ç¼–æ’ + å£°æ˜å¼ | LCEL | ç¾¤èŠ/ä»£ç† | æµç¨‹å®šä¹‰ |
| å¯è§‚æµ‹æ€§ | OpenTelemetry å†…ç½® | Callbacks | æ—¥å¿— | åŸºç¡€æ—¥å¿— |
| MCP æ”¯æŒ | âœ… åŸç”Ÿ | ğŸ”¶ éƒ¨åˆ† | âŒ | âŒ |
| ä¼ä¸šçº§ | âœ… å¼º | ğŸ”¶ ä¸­ç­‰ | âœ… å¼º | ğŸ”¶ ä¸­ç­‰ |
| å­¦ä¹ æ›²çº¿ | ä¸­ç­‰ | é™¡å³­ | é™¡å³­ | å¹³ç¼“ |

---

## ä¸ƒã€æºç è´¨é‡è¯„ä¼°

### 7.1 ä»£ç è§„èŒƒ

| ç»´åº¦ | è¯„åˆ† | è¯´æ˜ |
|------|------|------|
| ç±»å‹æ³¨è§£ | â­â­â­â­â­ | å®Œæ•´çš„ç±»å‹æç¤ºï¼Œæ³›å‹ä½¿ç”¨ç²¾å¦™ |
| æ–‡æ¡£æ³¨é‡Š | â­â­â­â­â­ | è¯¦å°½çš„ docstringï¼Œå«ç¤ºä¾‹ä»£ç  |
| ä»£ç ç»“æ„ | â­â­â­â­â­ | æ¸…æ™°çš„åˆ†å±‚ï¼Œå•ä¸€èŒè´£åŸåˆ™ |
| é”™è¯¯å¤„ç† | â­â­â­â­ | è‡ªå®šä¹‰å¼‚å¸¸ä½“ç³»ï¼Œå¯æ‰©å±• |
| æµ‹è¯•è¦†ç›– | â­â­â­â­ | samples ä¸°å¯Œï¼Œå•å…ƒæµ‹è¯•å¾…åŠ å¼º |

### 7.2 æ¶æ„äº®ç‚¹

1. **åè®®ä¼˜äºç»§æ‰¿** - çµæ´»çš„æ‰©å±•æœºåˆ¶
2. **åˆ†å±‚è®¾è®¡** - æ ¸å¿ƒ/ç¼–æ’/åº”ç”¨ä¸‰å±‚åˆ†ç¦»
3. **æ³›å‹åº”ç”¨** - ç¼–è¯‘æ—¶ç±»å‹å®‰å…¨
4. **å¼‚æ­¥ä¼˜å…ˆ** - å…¨é“¾è·¯ async/await
5. **å¯ç»„åˆæ€§** - ä¸­é—´ä»¶ã€å·¥å…·ã€ç¼–æ’è‡ªç”±ç»„åˆ

### 7.3 æ”¹è¿›ç©ºé—´

1. éƒ¨åˆ†ç±»èŒè´£è¿‡é‡ï¼ˆå¦‚ RawAgent çº¦ 1400 è¡Œï¼‰
2. æµ‹è¯•è¦†ç›–ç‡å¯è¿›ä¸€æ­¥æå‡
3. é”™è¯¯æ¶ˆæ¯æœ¬åœ°åŒ–æ”¯æŒ
4. æ›´å¤šå¯è§†åŒ–è°ƒè¯•å·¥å…·

---

## å…«ã€ä½¿ç”¨ç¤ºä¾‹

### 8.1 åŸºç¡€ Agent

```python
from agent_framework.azure import AzureOpenAIResponsesClient
from azure.identity import AzureCliCredential

agent = AzureOpenAIResponsesClient(
    credential=AzureCliCredential(),
).as_agent(
    name="HaikuBot",
    instructions="You are an upbeat assistant that writes beautifully.",
)

response = await agent.run("Write a haiku about Microsoft Agent Framework.")
print(response.text)
```

### 8.2 å¸¦å·¥å…· Agent

```python
@tool
def get_weather(location: str, unit: str = "celsius") -> str:
    """Get weather for a location."""
    return f"Weather in {location}: 25Â°{unit}"

agent = client.as_agent(
    name="weather-assistant",
    instructions="Help users with weather queries.",
    tools=[get_weather],
)
```

### 8.3 å¤š Agent å·¥ä½œæµ

```python
from agent_framework.orchestrations import Sequential

workflow = Sequential([
    researcher.as_agent(name="researcher"),
    writer.as_agent(name="writer"),
    reviewer.as_agent(name="reviewer")
])

result = await workflow.run("Write a blog post about AI agents")
```

### 8.4 æµå¼å“åº”

```python
stream = agent.run("Tell me a story", stream=True)
async for update in stream:
    print(update.text, end="", flush=True)
    
final_response = await stream.get_final_response()
```

---

## ä¹ã€æ€»ç»“ä¸å±•æœ›

### 9.1 æ ¸å¿ƒä¼˜åŠ¿

1. **ä¼ä¸šçº§è®¾è®¡** - å¾®è½¯èƒŒä¹¦ï¼Œæ³¨é‡ç”Ÿäº§ç¯å¢ƒ
2. **åŒæ ˆæ”¯æŒ** - Python + .NET ç”Ÿæ€å…¨è¦†ç›–
3. **ç°ä»£æ¶æ„** - MCPã€OpenTelemetryã€å£°æ˜å¼å·¥ä½œæµ
4. **ç±»å‹å®‰å…¨** - ç²¾å¦™çš„æ³›å‹è®¾è®¡
5. **æ¸è¿›å¤æ‚åº¦** - ä»ç®€å• Agent åˆ°å¤æ‚ç¼–æ’

### 9.2 é€‚ç”¨åœºæ™¯

- âœ… ä¼ä¸šçº§ AI åº”ç”¨å¼€å‘
- âœ… å¤š Agent åä½œç³»ç»Ÿ
- âœ… éœ€è¦ .NET é›†æˆçš„åœºæ™¯
- âœ… å¼ºå¯è§‚æµ‹æ€§è¦æ±‚çš„é¡¹ç›®
- âœ… MCP ç”Ÿæ€é›†æˆ

### 9.3 å‘å±•è¶‹åŠ¿

1. **AI Agent æ ‡å‡†åŒ–** - æ¨åŠ¨ Agent åè®®ç»Ÿä¸€
2. **MCP ç”Ÿæ€ç¹è£** - å·¥å…·/æ•°æ®æºæ ‡å‡†åŒ–æ¥å…¥
3. **å£°æ˜å¼ä¼˜å…ˆ** - YAML/JSON å®šä¹‰å·¥ä½œæµ
4. **å¤šæ¨¡æ€æ‰©å±•** - å›¾åƒã€è¯­éŸ³ã€è§†é¢‘ Agent

---

## åã€å‚è€ƒèµ„æº

- **å®˜æ–¹æ–‡æ¡£**: https://learn.microsoft.com/agent-framework/
- **GitHub**: https://github.com/microsoft/agent-framework
- **PyPI**: https://pypi.org/project/agent-framework/
- **Discord**: https://discord.gg/b5zjErwbQM
- **è®¾è®¡æ–‡æ¡£**: `/docs/design/` ç›®å½•

---

*æŠ¥å‘Šç”Ÿæˆæ—¶é—´: 2026-02-12 03:00 AM (Asia/Shanghai)*  
*åˆ†æå·¥å…·: OpenClaw Code Analysis Engine*
